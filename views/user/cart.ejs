<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description"
		content="Responsive Bootstrap4 Shop Template, Created by Imran Hossain from https://imransdesign.com/">

	<!-- title -->
	<title>Cart</title>

	<!-- favicon -->
	<link rel="shortcut icon" type="image/png" href="assets/img/favicon.png">
	<!-- google font -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Poppins:400,700&display=swap" rel="stylesheet">
	<!-- fontawesome -->
	<link rel="stylesheet" href="assets/css/all.min.css">
	<!-- bootstrap -->
	<link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
	<!-- owl carousel -->
	<link rel="stylesheet" href="assets/css/owl.carousel.css">
	<!-- magnific popup -->
	<link rel="stylesheet" href="assets/css/magnific-popup.css">
	<!-- animate css -->
	<link rel="stylesheet" href="assets/css/animate.css">
	<!-- mean menu css -->
	<link rel="stylesheet" href="assets/css/meanmenu.min.css">
	<!-- main style -->
	<link rel="stylesheet" href="assets/css/main.css">
	<!-- responsive -->
	<link rel="stylesheet" href="assets/css/responsive.css">

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

</head>

<body>

	<!--PreLoader-->
	<div class="loader">
		<div class="loader-inner">
			<div class="circle"></div>
		</div>
	</div>
	<!--PreLoader Ends-->

	<!-- header -->
	<div class="top-header-area" id="sticker">
		<div class="container">
			<div class="row">
				<div class="col-lg-12 col-sm-12 text-center">
					<div class="main-menu-wrap">
						<!-- logo -->
						<div class="site-logo">
							<a href="">
								<img src="assets/img/logo.png" alt="">
							</a>
						</div>
						<!-- logo -->

						<!-- menu start -->
						<nav class="main-menu">
							<ul>
								<li class="current-list-item"><a href="/">Home</a>
									<!-- <ul class="sub-menu">
										<li><a href="index.html">Static Home</a></li>
										<li><a href="index_2.html">Slider Home</a></li>
									</ul> -->
								</li>
								<li><a href="/shop">Shop</a>
									<!-- <ul class="sub-menu">
										<li><a href="/shop">Shop</a></li>
										<li><a href="checkout.html">Check Out</a></li>
										<li><a href="single-product.html">Single Product</a></li>
										<li><a href="cart.html">Cart</a></li>
									</ul> -->
								</li>
								<!-- <li><a href="about.html">Account</a></li> -->
								<!-- <li><a href="#">Pages</a>
									<ul class="sub-menu">
										<li><a href="404.html">404 page</a></li>
										<li><a href="about.html">About</a></li>
										<li><a href="cart.html">Cart</a></li>
										<li><a href="checkout.html">Check Out</a></li>
										<li><a href="contact.html">Contact</a></li>
										<li><a href="news.html">News</a></li>
										<li><a href="shop.html">Shop</a></li>
									</ul>
								</li>
								<li><a href="news.html">News</a>
									<ul class="sub-menu">
										<li><a href="news.html">News</a></li>
										<li><a href="single-news.html">Single News</a></li>
									</ul>
								</li> -->
								<!-- <li><a href="/contact">Contact</a></li> -->
								<%if (user){%>
									<li style="color:white; font-weight: 700;"> Hi <%= user.Username%>
											<ul class="sub-menu">
												<li><a href="/logout">logout</a></li>
												<li><a href="/profile">Profile</a></li>
												<li><a href="/order-details">Order</a></li>
											</ul>
									</li>
									<%}else{%>
										<li><a href="/login">Login</a></li>
										<%}%>

											<li>
												<div class="header-icons">
													<a class="shopping-cart" href=""><i
															class="fas fa-shopping-cart"></i></a>
													<a class="mobile-hide search-bar-icon" href="#"><i
															class="fas fa-search"></i></a>
												</div>
											</li>
							</ul>
						</nav>
						<a class="mobile-show search-bar-icon" href="#"><i class="fas fa-search"></i></a>
						<div class="mobile-menu"></div>
						<!-- menu end -->
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end header -->

	<!-- search area -->
	<div class="search-area">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<span class="close-btn"><i class="fas fa-window-close"></i></span>
					<div class="search-bar">
						<div class="search-bar-tablecell">
							<h3>Search For:</h3>
							<input type="text" placeholder="Keywords">
							<button type="submit">Search <i class="fas fa-search"></i></button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end search arewa -->

	<!-- breadcrumb-section -->
	<div class="breadcrumb-section breadcrumb-bg">
		<div class="container">
			<div class="row">
				<div class="col-lg-8 offset-lg-2 text-center">
					<div class="breadcrumb-text">
						<p>Fresh and Organic</p>
						<h1>Cart</h1>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end breadcrumb section -->

	<!-- cart -->
	<% if (product.length !=0) { %>

		<div class="cart-section mt-150 mb-150">
			<div class="container">
				<div class="row">
					<div class="col-lg-8 col-md-12">
						<div class="cart-table-wrap">
							<table class="cart-table">
								<thead class="cart-table-head">
									<tr class="table-head-row">
										<!-- <th class="product-remove"></th> -->
										<th class="product-image">Product Image</th>
										<th class="product-name">Name</th>
										<th class="product-price">Price</th>
										<th class="product-quantity">Quantity</th>
										<th class="product-total">Cancel</th>
									</tr>
								</thead>
								<tbody>
									<% let status=false %>
										<% for(var i=0;i < product.length; i++ ){ %>

											<tr class="table-body-row">
												<td class="product-image"><img src="<%=product[i].Cart.Image1%>"
														alt="asasas"></td>
												<td class="product-name">
													<%= product[i].Cart.Name%>
												</td>

												<td class="product-price">
													<span id="<%= product[i].Cart._id%>i">
														<% if (product[i].Cart.Price> product[i].Cart.CategoryOffer &&
															product[i].Cart.ProductOffer >
															product[i].Cart.CategoryOffer) { %>

															<%=product[i].Cart.CategoryOffer%>
																<%}%>




																	<% if (product[i].Cart.Price>
																		product[i].Cart.ProductOffer
																		&& product[i].Cart.CategoryOffer
																		> product[i].Cart.ProductOffer) { %>
																		<%=product[i].Cart.ProductOffer%>
																			<%} else { %>

																				<% } %>


																					<% if (product[i].Cart.Price
																						<=product[i].Cart.ProductOffer
																						&& product[i].Cart.Price
																						<=product[i].Cart.CategoryOffer)
																						{ %>
																						<%=product[i].Cart.Price%>
																							<%} else { %>

																								<% } %>

													</span>
												</td>







												<td>
													<div class="quantity-field">

														<button class="value-button decrease-button"
															onclick="changeQuantity( '<%=product[i]._id%>','<%= product[i].Cart._id %>',-1,document.getElementById('<%= product[i].Cart._id%>i').innerText)">-
														</button>

														<div class="number" id="<%= product[i].Cart._id %>">
															<%=product[i].quantity %>
														</div>
														<button class="value-button increase-button"
															onclick="changeQuantity( '<%=product[i]._id%>','<%= product[i].Cart._id %>',1,document.getElementById('<%= product[i].Cart._id%>i').innerText, '<%= product[i].Cart.Quatity %>')">+
														</button>
													</div>
												</td>
												<td>
													<div class="cart-buttons">

														<!-- <a href="/cancel-order?id=<%= product[i].Cart._id %>" class="boxed-btn black" style="background-color: rgb(124, 12, 12); ">Cancel</a> -->
														<a class="boxed-btn black"
															style="background-color: rgb(239, 217, 20); "
															onclick="Cancel('<%=product[i]._id%>','<%= product[i].Cart._id %>')">‚ùå</a>
													</div>
												</td>
											</tr>
											<script>
												document.getElementById('total').innerHTML = Number((document.getElementById('total').innerHTML) * parseInt(document.getElementById('<%= product[i].Cart._idd %>').innerHTML))
											</script>

											<script>
												let quantity
												let productQuantity = document.getElementById('<%= product[i].Cart._id %>').innerText
												for (let i = 0; i < '<%= product.length%>'; i++) {
													if (productQuantity < '<%= product[i].Cart.Quatity%>') {


													} else {

														ProductCancel()
													}
												}

											</script>
 
											<% if(product[i].quantity  > product[i].Cart.Quatity){%>

												<% status=true %>

													<%}%>
														<%}%>
								</tbody>
								<script>
									function Cancel(cartId, proId) {
										Swal.fire({
											title: 'Are you sure?',
											text: "You won't be able to revert this!",
											icon: 'warning',
											showCancelButton: true,
											confirmButtonColor: '#3085d6',
											cancelButtonColor: '#d33',
											confirmButtonText: 'Yes, delete it!'
										}).then((result) => {
											console.log(result);
											if (result.isConfirmed) {
												$.ajax({
													url: "/cancel-order",
													data: {
														cart: cartId,
														product: proId,
													},
													method: 'post',
													success: (response) => {
														if (response.CancelOrder) {
															Swal.fire(
																'Deleted!',
																'Your file has been deleted.',
																'success'
															)
															setTimeout(() => {
																window.location.reload()
															}, 1000)
														}
													}
												})

											}
										})
									}

								</script>
							</table>
						</div>
					</div>
					<script>

						function changeQuantity(cartId, proId, count, price, quant) {

							if ((Number(document.getElementById(proId).innerText) - 1 > 0 && count == -1) || (Number(document.getElementById(proId).innerText) + 1 <= quant && (count == 1))) {
								$.ajax({
									url: '/change-product-quantity',
									data: {
										cart: cartId,
										product: proId,
										count: count,
									},
									method: 'post',
									success: (response) => {
										if (count == 1) {
											document.getElementById(proId).innerText = Number(document.getElementById(proId).innerText) + 1
											increase(price)
										} else {
											if ((Number(document.getElementById(proId).innerText) - 1) > 0) {
												decraese(price)
												document.getElementById(proId).innerText = Number(document.getElementById(proId).innerText) - 1
											}
										}

									}
								})
							}
						}
					</script>

					<div class="col-lg-4">
						<div class="total-section">
							<table class="total-table">
								<thead class="total-table-head">
									<tr class="table-total-row">
										<th>Total</th>
										<th>Price</th>
									</tr>
								</thead>
								<tbody>

									<tr class="total-data" id="coupen">
										<td><strong>Total: </strong></td>
										<td> <span id="total">
												<%=total%>
											</span> </td>
									</tr>
								</tbody>

							</table>

						</div>


						<div class="cart-buttons">
							<!-- <a href="/address-management" class="boxed-btn black" id="placeorder">Place Order</a> -->

						</div>
						<% if( status == true ){%>
							
							<a  class="boxed-btn black" onclick="placeErr()"> Place Order </a>
								<%}else{%>
									<a href="/address-management" class="boxed-btn black " id="placeorder">Place
										Order</a>
									
							<%}%>
							
							
							<script>
								function placeErr() {
									Swal.fire({
										icon: 'error',
										title: 'Oops...',
										text: 'Please Reduce The Quantity',
			
									})
								}
							</script>


						<script>
							function increase(price) {

								document.getElementById('total').innerHTML = parseInt(document.getElementById('total').innerHTML) + parseInt(price)
							}
							function decraese(price) {

								document.getElementById('total').innerHTML = parseInt(document.getElementById('total').innerHTML) - parseInt(price)
							}
						</script>

						<div class="coupon-section">
							<h3>Apply Coupon</h3>
							<div class="coupon-form-wrap">
								<form id="coupon1">
									<p><input type="text" placeholder="Coupon" name="Coupon"></p>
									<p><input type="submit" value="Apply"></p>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<%} else { %>
			<h4>CART Is EMPTY PLEASE CONTINUE SHOPPING</h4>
			<% } %>
				<script>
					function updateDiv() {


					}

					$('#coupon1').submit((e) => {
						console.log('done');
						e.preventDefault()
						$.ajax({
							url: "/apply-coupon",
							method: "post",
							data: $('#coupon1').serialize(),
							success: (response) => {
								if (response.result1) {
									invalid('Invalid Coupon !')
								} else if (response.result2) {
									invalid('Coupon Not Started Yet ')
								}
								else if (response.result3) {
									invalid(' Your Coupon Is Expired!! ')
								}
								else if (response.result4) {
									invalid('You Must Buy Above 100')
								}
								else if (response.result5) {
									invalid('Coupon Already Used!!')
								}
								else if (response.status) {
									alert('Coupon Applied')
								}
								$("#coupen").load(window.location.href + " #coupen");
							}
						})
					})
				</script>
				<script>
					function invalid(text1) {
						Swal.fire({
							icon: 'error',
							title: 'Oops...',
							text: text1,

						})
					}
				</script>
				<!-- end cart -->

				<!-- logo carousel -->
				<div class="logo-carousel-section">
					<div class="container">
						<div class="row">
							<div class="col-lg-12">
								<div class="logo-carousel-inner">
									<div class="single-logo-item">
										<img src="assets/img/company-logos/1.png" alt="">
									</div>
									<div class="single-logo-item">
										<img src="assets/img/company-logos/2.png" alt="">
									</div>
									<div class="single-logo-item">
										<img src="assets/img/company-logos/3.png" alt="">
									</div>
									<div class="single-logo-item">
										<img src="assets/img/company-logos/4.png" alt="">
									</div>
									<div class="single-logo-item">
										<img src="assets/img/company-logos/5.png" alt="">
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!-- end logo carousel -->

				<!-- footer -->
				<div class="footer-area">
					<div class="container">
						<div class="row">
							<div class="col-lg-3 col-md-6">
								<div class="footer-box about-widget">
									<h2 class="widget-title">About us</h2>
									<p>Ut enim ad minim veniam perspiciatis unde omnis iste natus error sit voluptatem
										accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae.</p>
								</div>
							</div>
							<div class="col-lg-3 col-md-6">
								<div class="footer-box get-in-touch">
									<h2 class="widget-title">Get in Touch</h2>
									<ul>
										<li>34/8, East Hukupara, Gifirtok, Sadan.</li>
										<li>support@fruitkha.com</li>
										<li>+00 111 222 3333</li>
									</ul>
								</div>
							</div>
							<div class="col-lg-3 col-md-6">
								<div class="footer-box pages">
									<h2 class="widget-title">Pages</h2>
									<ul>
										<li><a href="">Home</a></li>
										<li><a href="">About</a></li>
										<li><a href="">Shop</a></li>
										<li><a href="">News</a></li>
										<li><a href="">Contact</a></li>
									</ul>
								</div>
							</div>
							<div class="col-lg-3 col-md-6">
								<div class="footer-box subscribe">
									<h2 class="widget-title">Subscribe</h2>
									<p>Subscribe to our mailing list to get the latest updates.</p>
									<form action="">
										<input type="email" placeholder="Email">
										<button type="submit"><i class="fas fa-paper-plane"></i></button>
									</form>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!-- end footer -->

				<!-- copyright -->
				<div class="copyright">
					<div class="container">
						<div class="row">
							<div class="col-lg-6 col-md-12">
								<p>Copyrights &copy; 2019 - <a href="https://imransdesign.com/">Imran Hossain</a>, All
									Rights Reserved.<br>
									Distributed By - <a href="https://themewagon.com/">Themewagon</a>
								</p>
							</div>
							<div class="col-lg-6 text-right col-md-12">
								<div class="social-icons">
									<ul>
										<li><a href="#" target="_blank"><i class="fab fa-facebook-f"></i></a></li>
										<li><a href="#" target="_blank"><i class="fab fa-twitter"></i></a></li>
										<li><a href="#" target="_blank"><i class="fab fa-instagram"></i></a></li>
										<li><a href="#" target="_blank"><i class="fab fa-linkedin"></i></a></li>
										<li><a href="#" target="_blank"><i class="fab fa-dribbble"></i></a></li>
									</ul>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!-- end copyright -->
				<!-- sweeeet aler -->
				<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

				<!-- jquery -->
				<script src="assets/js/jquery-1.11.3.min.js"></script>
				<!-- bootstrap -->
				<script src="assets/bootstrap/js/bootstrap.min.js"></script>
				<!-- count down -->
				<script src="assets/js/jquery.countdown.js"></script>
				<!-- isotope -->
				<script src="assets/js/jquery.isotope-3.0.6.min.js"></script>
				<!-- waypoints -->
				<script src="assets/js/waypoints.js"></script>
				<!-- owl carousel -->
				<script src="assets/js/owl.carousel.min.js"></script>
				<!-- magnific popup -->
				<script src="assets/js/jquery.magnific-popup.min.js"></script>
				<!-- mean menu -->
				<script src="assets/js/jquery.meanmenu.min.js"></script>
				<!-- sticker js -->
				<script src="assets/js/sticker.js"></script>
				<!-- main js -->
				<script src="assets/js/main.js"></script>
				<style>
					.quantity-field {
						display: flex;
						justify-content: center;
						align-items: center;
						width: 120px;
						height: 40px;
						margin: 0 auto;
					}

					.quantity-field .value-button {
						border: 1px solid #ddd;
						margin: 0px;
						width: 40px;
						height: 100%;
						padding: 0;
						background: #eee;
						outline: none;
						cursor: pointer;
					}

					.quantity-field .value-button:hover {
						background: rgb(230, 230, 230);
					}

					.quantity-field .value-button:active {
						background: rgb(210, 210, 210);
					}

					.quantity-field .decrease-button {
						margin-right: -4px;
						border-radius: 8px 0 0 8px;
					}

					.quantity-field .increase-button {
						margin-left: -4px;
						border-radius: 0 8px 8px 0;
					}

					.quantity-field .number {
						display: inline-block;
						text-align: center;
						border: none;
						border-top: 1px solid #ddd;
						border-bottom: 1px solid #ddd;
						margin: 0px;
						width: 40px;
						height: 100%;
						line-height: 40px;
						font-size: 11pt;
						box-sizing: border-box;
						background: white;
						font-family: calibri;
					}

					.quantity-field .number::selection {
						background: none;
					}

					/*
input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
}
*/
				</style>

</body>

</html>